#!/usr/bin/env bash

# Combines the local system dictionary with the Neovim dictionary.

set -euo pipefail

# Define the paths to the dictionaries
local_dictionary="$HOME/Library/Spelling/LocalDictionary"
nvim_dictionary="$HOME/.config/nvim/spell/en.utf-8.add"

# Ensure the directories exist
mkdir -p "$(dirname "$local_dictionary")"
mkdir -p "$(dirname "$nvim_dictionary")"

# Create the files if they don't exist
touch "$local_dictionary"
touch "$nvim_dictionary"

# Create a temporary file for the merged dictionary
temp_dictionary=$(mktemp)

# Combine both dictionaries, sort, and remove duplicates
cat "$local_dictionary" "$nvim_dictionary" | sort | uniq >"$temp_dictionary"

# Write the combined dictionary back to both files
cp "$temp_dictionary" "$local_dictionary"
cp "$temp_dictionary" "$nvim_dictionary"

# Clean up
rm "$temp_dictionary"

# Regenerate the Neovim spell file
if command -v nvim &>/dev/null; then
  nvim --headless -c "mkspell! $nvim_dictionary" -c "quit"
fi

echo "Dictionary synchronization completed at $(date)."
