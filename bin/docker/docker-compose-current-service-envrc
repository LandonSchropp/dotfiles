#!/usr/bin/env ruby

# frozen_string_literal: true

require 'yaml'

# This script copies the environment out of the docker-compose.yml and docker-compose.override.yml
# files and converts it to an shell format for use with direnv.

# Grab the current service name.
service = YAML.load(`docker-compose-current-service-configuration`)
exit 1 unless $?.success?

# Convert the environment to a shell format.
puts service
  .fetch("environment", {})
  .map { |key, value| "export #{ key }=#{ (key =~ /_HOST\z/ ? "localhost" : key).to_s.dump }" }
  .join("\n")
